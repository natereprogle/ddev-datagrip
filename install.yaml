name: datagrip

pre_install_actions:
  - |
    #ddev-description: Check if datagrip is available
    if ! command -v datagrip >/dev/null 2>&1; then
      echo "âŒ DataGrip is not installed or not in PATH."
      echo "   Refer to DataGrip's documentation to configure the PATH: https://www.jetbrains.com/help/datagrip/working-with-the-ide-features-from-command-line.html"
      exit 1
    fi

  - |
    #ddev-description: Create directory structure for DataGrip

    # Define directories
    BASE_DIR="${DDEV_APPROOT}/.ddev/datagrip"
    IDEA_DIR="${BASE_DIR}/.idea"

    # Create directories
    mkdir -p "$IDEA_DIR"

project_files:
  - commands/host/datagrip

ddev_version_constraint: ">= v1.24.10"

post_install_actions:
  - |
    #ddev-description: Make `ddev datagrip` command executable
    chmod +x "${DDEV_APPROOT}/.ddev/commands/host/datagrip"

removal_actions:
  - |
    #ddev-description: Remove `ddev datagrip` command
    rm "${DDEV_APPROOT}/.ddev/commands/host/datagrip"
  - |
    #ddev-description: Remove leftover files and directories
    TARGET_DIR="${DDEV_APPROOT}/.ddev/datagrip"
    if [ -d "$TARGET_DIR" ]; then
      rm -rf "$TARGET_DIR"
    fi
  - |
    #ddev-description: Output that certain files may have been left behind
    echo "ddev-datagrip has been removed, we hope it was useful to you!"
    echo ""
    echo "Do note: If you had a Postgres DB and used `ddev datagrip -p` at any point in time, ~/.pgpass and ~/.pgpass.bak files may have been created or modified"
    echo "You may want to remove the ~/.pgpass.bak file and review the ~/.pgpass file for changes, removing any references to the DDEV database if necessary"