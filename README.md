[![add-on registry](https://img.shields.io/badge/DDEV-Add--on_Registry-blue)](https://addons.ddev.com)
[![tests](https://github.com/natereprogle/ddev-datagrip/actions/workflows/tests.yml/badge.svg?branch=main)](https://github.com/natereprogle/ddev-datagrip/actions/workflows/tests.yml?query=branch%3Amain)
[![last commit](https://img.shields.io/github/last-commit/natereprogle/ddev-datagrip)](https://github.com/natereprogle/ddev-datagrip/commits)
[![release](https://img.shields.io/github/v/release/natereprogle/ddev-datagrip)](https://github.com/natereprogle/ddev-datagrip/releases/latest)

# DDEV DataGrip Add-on

## Overview
This Add-on allows you to open a DataGrip instance and connect to your local DDEV database without any manual configuration. It can also automatically select between MariaDB and MySQL drivers without any user input, based on the configured Database Family in the DDEV config. 

> [!IMPORTANT]
> Currently, MariaDB and MySQL are the only supported database types. PostgreSQL may be supported in the future.

## Installation
```sh
ddev add-on get natereprogle/ddev-datagrip
ddev restart
```

After installation, make sure to commit the .ddev directory to version control.

> [!CAUTION]
> If you are using DB credentials that are not the default `root:root` credentials, do **NOT** commit `.ddev/datagrip` to your Git repository. See the FAQ below for more information.

## Usage
| Argument | Description |
|----------|-------------|
| `--database [database]` | Specify the database to connect to |
| `--reset` | Resets the DataGrip project, including configuration and generated schemas. A manual refresh will be required upon next launch of DataGrip |
| `--auto-refresh [time in seconds]` | Enables auto-refresh in DataGrip. This only works if the datasource has been refreshed at least once. Minimum of 0.1 minutes (6 seconds), set to 0 to disable. Default is 1 minute |
| `--help` | Get command help |

Connect to your local default DDEV database
```sh
ddev datagrip
```

Connect to your local DDEV database using a specific database name
```sh
ddev datagrip --database my-db
```

Reset your datagrip configuration and datasource (note this will require you to manually refresh the datasource onced datagrip is launched)
```sh
ddev datagrip --reset
```

# Known Issues & Limitations
## Initial Data Refresh
Unlike other SQL tools like Sequel Ace, SQL Pro, and others which can be launched with CLI arguments to immediately connect to a Database, DataGrip requires a "Project". A "Project" is a directory which contains several configuration files, including `./.idea/dataSources.xml` and the DB schema, located in `./.idea/dataSources/` and generated by DataGrip automatically. Projects must be created with the DataGrip GUI.

In order to support DataGrip *at all*, this Add-On creates a "project" and the necessary configuration files for you within the `.ddev/datagrip` directory. Normally, when you create a project in DataGrip, you would add a datasource in the UI and DataGrip automatically does an initial "refresh" to generate schemas. However, since the add-on "creates" this datasource for you outside of DataGrip, before DataGrip even launches, DataGrip does **not** automatically refresh the datasource.

As a result, the initial refresh never happens, and so schema are never generated. Automatic Introspection will also never run, and subsequent launches of DataGrip will **never** generate schema. No specific configuration settings seemed to be able to change this behavior. The only workaround for this issue is to do a manual refresh on the very first launch of DataGrip. Future usage of the `ddev datagrip` command will not require a refresh on its own. However, if the DB schema is changed, datagrip may require a manual refresh again. *This is a limitation of DataGrip, not DDEV or this add-on*. We hope this can be improved in the future.

## Cleartext DB Credentials
DDEV uses `root:root` as its DB credentials. As it's meant for local development, they've also stated they have [no plans to allow changing this](https://github.com/ddev/ddev/issues/5723). This add-on stores DDEV's DB credentials in plaintext in the JDBC URL within `dataSources.xml`. Certain tools, like Gitleaks, may pick up on these credentials and throw a fit. You will need to make adjustments to your tooling if storing these credentials in plaintext is an issue.